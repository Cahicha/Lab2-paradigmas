estoy con licencia :(
TDA usuario
% Usuario = [Id, Nombre, Deuda, LibrosPrestados, Estado]
% Estado = activo | suspendido
constructor
% crearUsuario(Id, Nombre, Usuario)
crearUsuario(Id, Nombre, [Id, Nombre, 0, [], activo]).
Selectores
usuarioId([Id,_,_,_,_], Id).
usuarioNombre([_,Nombre,_,_,_], Nombre).
usuarioDeuda([_,_,Deuda,_,_], Deuda).
usuarioLibros([_,_,_,Libros,_], Libros).
usuarioEstado([_,_,_,_,Estado], Estado).
Modificadores
setUsuarioDeuda([Id,N,D,L,E], Nueva, [Id,N,Nueva,L,E]).
setUsuarioLibros([Id,N,D,_,E], NuevaL, [Id,N,D,NuevaL,E]).
setUsuarioEstado([Id,N,D,L,_], NuevoE, [Id,N,D,L,NuevoE]).

TDA Libro
% Libro = [Id, Titulo, Autor, Disponible]
% Disponible = si | no
Const
crearLibro(Id, Titulo, Autor, [Id, TituloMin, AutorMin, si]) :-
    string_lower(Titulo, TituloMin),
    string_lower(Autor, AutorMin).

selectores
libroId([Id,_,_,_], Id).
libroTitulo([_,Titulo,_,_], Titulo).
libroAutor([_,_,Autor,_], Autor).
libroDisponible([_,_,_,Disp], Disp).
modificadores
setLibroDisponible([Id,T,A,_], Nuevo, [Id,T,A,Nuevo]).

TDA biblioteca
% Biblioteca =
% [ Libros,
%   Usuarios,
%   Prestamos,
%   MaxLibrosUsuario,
%   DiasMaxPrestamo,
%   TasaMulta,
%   LimiteDeuda,
%   DiasMaxRetraso,
%   FechaActual ]
constructor
crearBiblioteca(Libros, Usuarios, Prestamos,
                MaxLibros, DiasMax, Tasa,
                Limite, DiasRet, Fecha,
                [Libros, Usuarios, Prestamos,
                 MaxLibros, DiasMax, Tasa,
                 Limite, DiasRet, Fecha]).

selectores
bibLibros([L|_], L).
bibUsuarios([_,U|_], U).
bibPrestamos([_,_,P|_], P).
bibMaxLibros([_,_,_,M|_], M).
bibDiasMax([_,_,_,_,Dmax|_], Dmax).
bibTasa([_,_,_,_,_,T|_], T).
bibLimite([_,_,_,_,_,_,Lim|_], Lim).
bibDiasRet([_,_,_,_,_,_,_,R|_], R).
bibFecha([_,_,_,_,_,_,_,_,F], F).
Modificadores
setBibLibros([_,U,P,M,D,T,L,DR,F], NL,
             [NL,U,P,M,D,T,L,DR,F]).

setBibUsuarios([L,_,P,M,D,T,Lm,DR,F], NU,
               [L,NU,P,M,D,T,Lm,DR,F]).

setBibPrestamos([L,U,_,M,D,T,Lm,DR,F], NP,
                [L,U,NP,M,D,T,Lm,DR,F]).

TDA prestamo
constructor

crearPrestamo(Id, IdUsuario, IdLibro, Fecha, Dias, [Id, IdUsuario, IdLibro, Fecha, Dias]) :-
    diasMaxPrestamoGlobal(DMax),
    Dias =< DMax.

TDA fecha

%pertenencia
fecha_valida(fecha(D, M)) :-
    integer(D), integer(M),
    D >= 1, D =< 30,
    M >= 1, M =< 12.

%constructores%
crear_fecha(D, M, fecha(D, M)) :-
    fecha_valida(fecha(D, M)), !.
crear_fecha(D, M, _) :-
    format([D, M]),
    fail.

%selectores%
dia(fecha(D, _), D).
mes(fecha(_, M), M).

%funciones utiles%
%avanzar dia%
avanzar_dia(fecha(D, M), fecha(D2, M2)) :-
    ( D < 30 ->
        D2 is D + 1,
        M2 is M
    ;
        D2 is 1,
        M2 is M + 1
    ),
    fecha_valida(fecha(D2, M2)).

%avanzar n dias%
avanzar_varios_dias(Fecha, 0, Fecha) :- !.
avanzar_varios_dias(Fecha, N, R) :-
    N > 0,
    avanzar_dia(Fecha, F2),
    N1 is N - 1,
    avanzar_varios_dias(F2, N1, R).

% dias edesde inicio%
dias_desde_inicio(fecha(D, M), R) :-
    R is (M - 1) * 30 + D.

%diferencia entre fechas%
dias_entre(F1, F2, Diff) :-
    dias_desde_inicio(F1, A),
    dias_desde_inicio(F2, B),
    Diff is B - A.
%funcion agregar libro%


agregarLibro(BibliotecaIn, Libro1, BibliotecaOut) :-

    bibLibros(BibliotecaIn, Libros),
    libroId(Libro1, NuevoId),

    (   existeLibroId(Libros, NuevoId)
    ->  BibliotecaOut = BibliotecaIn
    ;   append(Libros, [Libro1], Libros2),
        setBibLibros(BibliotecaIn, Libros2, BibliotecaOut)
    ).

% Auxiliar
existeLibroId([L|_], Id) :- libroId(L, Id), !.
existeLibroId([_|R], Id) :- existeLibroId(R, Id).
existeLibroId([], _) :- fail.

%funcion registrar usuario%

registrarUsuario(BibliotecaIn, Usuario, BibliotecaOut) :-

    bibUsuarios(BibliotecaIn, Users),
    usuarioId(Usuario, IdNuevo),

    (   existeUsuarioId(Users, IdNuevo)
    ->  BibliotecaOut = BibliotecaIn
    ;   append(Users, [Usuario], Users2),
        setBibUsuarios(BIn, Users2, BOut)
    ).

% Auxiliar %
existeUsuarioId([U|_], Id) :- usuarioId(U, Id), !.
existeUsuarioId([_|R], Id) :- existeUsuarioId(R, Id).
existeUsuarioId([], _) :- fail.

%obtener usuario%

obtenerUsuario(BibliotecaIn, Id, U) :-
    bibUsuarios(BibliotecaIn, Users),
    buscarUsuarioLista(Users, Id, U).

buscarUsuarioLista([Usuario|_], Id, Usuario) :-
    usuarioId(Usuario, Id), !.

buscarUsuarioLista([_|Resto], Id, Usuario) :-
    buscarUsuarioLista(Resto, Id, Usuario).

buscarUsuarioLista([], _, false).

%buscar libro%

buscarLibro(BibliotecaIn, "id", Valor, LibroOut) :-
    bibLibros(BibliotecaIn, Libros),
    buscarLibroPorId(Libros, Valor, LibroOut), !.

buscarLibro(BibliotecaIn, "titulo", Valor, LibroOut) :-
    bibLibros(BibliotecaIn, Libros),
    string_lower(Valor, ValorMin),
    buscarLibroPorTitulo(Libros, ValorMin, LibroOut), !.

buscarLibro(BibliotecaIn, "autor", Valor, LibroOut) :-
    bibLibros(BibliotecaIn, Libros),
    string_lower(Valor, ValorMin),
    buscarLibroPorAutor(Libros, ValorMin, LibroOut), !.

buscarLibro(_, _, _, false).

% auxiliares %

buscarLibroPorId([Libro|_], Id, Libro) :-
    libroId(Libro, Id), !.
buscarLibroPorId([_|Resto], Id, Libro) :-
    buscarLibroPorId(Resto, Id, Libro).
buscarLibroPorId([], _, false).

buscarLibroPorTitulo([Libro|_], ValorMin, Libro) :-
    libroTitulo(Libro, Titulo),
    sub_atom(Titulo, _, _, _, ValorMin), !.

buscarLibroPorTitulo([_|Resto], ValorMin, Libro) :-
    buscarLibroPorTitulo(Resto, ValorMin, Libro).
buscarLibroPorTitulo([], _, false).

buscarLibroPorAutor([Libro|_], ValorMin, Libro) :-
    libroAutor(Libro, Autor),
    sub_atom(Autor, _, _, _, ValorMin), !.

buscarLibroPorAutor([_|Resto], ValorMin, Libro) :-
    buscarLibroPorAutor(Resto, ValorMin, Libro).
buscarLibroPorAutor([], _, false).

%obtener id libro%
getLibroId(Libro, Id) :-
    libroId(Libro, Id).

%obtener fecha actual%
getFecha(Biblioteca, Fecha) :-
    bibFecha(Biblioteca, Fecha).

%verifinar disponibilidad de libro%
isLibroDisponible(BibliotecaIn, IdLibro) :-
    bibLibros(BibliotecaIn, Libros),
    buscarLibroPorId(Libros, IdLibro, LibroOut),
    LibroOut \= false,
    libroDisponible(LibroOut, si).

%verificar si el usuario esta suspendido%

isUsuarioSuspendido(Usuario) :-
    usuarioEstado(Usuario, suspendido).

%obtener deuda%

obtenerDeuda(Usuario, Deuda) :-
    usuarioDeuda(Usuario, Deuda).

%transformar fecha%

transformar_fecha(Str, Fecha) :-
    split_string(Str, "/", "", [Ds, Ms]),
    number_string(D, Ds),
    number_string(M, Ms),
    crear_fecha(D, M, Fecha).